# API Biblioteca - Sistema Completo de Gesti√≥n de Biblioteca

Esta es una API RESTful completa desarrollada con Spring Boot para la gesti√≥n integral de una biblioteca municipal, implementando todos los requerimientos del ejercicio de profundizaci√≥n.

## üöÄ Caracter√≠sticas Principales

- **Base de datos H2 embebida** - No requiere configuraci√≥n externa
- **JPA/Hibernate** - Mapeo objeto-relacional completo
- **Sistema de autenticaci√≥n y autorizaci√≥n** - Roles de bibliotecario y usuario
- **Gesti√≥n completa de usuarios** - Registro, login y administraci√≥n
- **Sistema de pr√©stamos** - Creaci√≥n, devoluci√≥n, renovaci√≥n y seguimiento
- **Validaci√≥n de datos** - Validaciones autom√°ticas en todas las entidades
- **Controladores RESTful** - Endpoints completos siguiendo principios REST
- **Manejo de excepciones** - Respuestas consistentes de error
- **Datos de ejemplo** - Base de datos poblada autom√°ticamente
- **Seguridad robusta** - Encriptaci√≥n de contrase√±as y control de acceso

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- Java 17
- Spring Boot 3.5.6
- Spring Data JPA
- Spring Security
- H2 Database
- Spring Validation
- Maven

## üìã Prerrequisitos

- Java 17 o superior
- Maven 3.6 o superior

## üèÉ‚Äç‚ôÇÔ∏è Ejecutar la Aplicaci√≥n

1. **Clonar el repositorio:**
   ```bash
   git clone <url-del-repositorio>
   cd api-biblioteca
   ```

2. **Compilar y ejecutar:**
   ```bash
   mvn clean install
   mvn spring-boot:run
   ```

3. **Acceder a la aplicaci√≥n:**
   - API: http://localhost:8080/api/libros
   - Consola H2: http://localhost:8080/h2-console
     - JDBC URL: `jdbc:h2:mem:testdb`
     - Usuario: `sa`
     - Contrase√±a: `password`

## üìö Endpoints de la API

### üîê Autenticaci√≥n (P√∫blico)
- `POST /api/auth/login` - Iniciar sesi√≥n
- `POST /api/auth/register` - Registro de usuario
- `GET /api/auth/validate` - Validar token

### üìñ Gesti√≥n de Libros (P√∫blico)
- `GET /api/libros` - Obtener todos los libros
- `GET /api/libros/{id}` - Obtener libro por ID
- `GET /api/libros/disponibles` - Obtener libros disponibles
- `GET /api/libros/prestados` - Obtener libros prestados
- `GET /api/libros/estadisticas` - Obtener estad√≠sticas

### üîç B√∫squeda de Libros (P√∫blico)
- `GET /api/libros/buscar/titulo?q={titulo}` - Buscar por t√≠tulo
- `GET /api/libros/buscar/autor?autor={autor}` - Buscar por autor
- `GET /api/libros/buscar/isbn/{isbn}` - Buscar por ISBN
- `GET /api/libros/estado/{estado}` - Buscar por estado
- `GET /api/libros/buscar?titulo={titulo}&autor={autor}&estado={estado}` - B√∫squeda m√∫ltiple

### üë• Gesti√≥n de Usuarios (Autenticado)
- `GET /api/usuarios` - Obtener todos los usuarios
- `GET /api/usuarios/{id}` - Obtener usuario por ID
- `POST /api/usuarios` - Crear nuevo usuario
- `PUT /api/usuarios/{id}` - Actualizar usuario
- `DELETE /api/usuarios/{id}` - Eliminar usuario
- `GET /api/usuarios/activos` - Obtener usuarios activos
- `GET /api/usuarios/bibliotecarios` - Obtener bibliotecarios
- `PATCH /api/usuarios/{id}/estado` - Cambiar estado del usuario
- `PATCH /api/usuarios/{id}/promover` - Promover a bibliotecario

### üìã Gesti√≥n de Pr√©stamos (Autenticado)
- `GET /api/prestamos` - Obtener todos los pr√©stamos
- `GET /api/prestamos/{id}` - Obtener pr√©stamo por ID
- `POST /api/prestamos` - Crear nuevo pr√©stamo
- `PATCH /api/prestamos/{id}/devolver` - Devolver libro
- `PATCH /api/prestamos/{id}/renovar` - Renovar pr√©stamo
- `GET /api/prestamos/activos` - Obtener pr√©stamos activos
- `GET /api/prestamos/vencidos` - Obtener pr√©stamos vencidos
- `GET /api/prestamos/usuario/{usuarioId}` - Pr√©stamos por usuario
- `GET /api/prestamos/libro/{libroId}` - Pr√©stamos por libro

## üìù Estructura de Datos

### Entidad Libro
```json
{
  "id": 1,
  "titulo": "El Quijote",
  "autor": "Miguel de Cervantes",
  "descripcion": "Obra maestra de la literatura espa√±ola...",
  "anioPublicacion": 1605,
  "isbn": "9788467034100",
  "numeroPaginas": 863,
  "fechaIngreso": "2024-01-15",
  "estado": "DISPONIBLE"
}
```

### Entidad Usuario
```json
{
  "id": 1,
  "nombre": "Juan",
  "apellido": "P√©rez",
  "email": "juan.perez@email.com",
  "telefono": "987654321",
  "direccion": "Avenida Central 456",
  "fechaNacimiento": "1990-08-22",
  "tipoUsuario": "USUARIO",
  "estado": "ACTIVO"
}
```

### Entidad Pr√©stamo
```json
{
  "id": 1,
  "usuarioId": 1,
  "libroId": 2,
  "fechaPrestamo": "2024-10-01",
  "fechaDevolucionEsperada": "2024-10-16",
  "fechaDevolucionReal": null,
  "estado": "ACTIVO",
  "observaciones": null,
  "multa": null,
  "nombreUsuario": "Juan P√©rez",
  "tituloLibro": "Cien a√±os de soledad",
  "autorLibro": "Gabriel Garc√≠a M√°rquez"
}
```

### Estados de Libro
- `DISPONIBLE` - Disponible para pr√©stamo
- `PRESTADO` - Prestado a un usuario
- `EN_REPARACION` - En reparaci√≥n
- `PERDIDO` - Perdido
- `RETIRADO` - Retirado del sistema

### Tipos de Usuario
- `BIBLIOTECARIO` - Acceso completo al sistema
- `USUARIO` - Puede realizar pr√©stamos y consultas

### Estados de Usuario
- `ACTIVO` - Usuario activo en el sistema
- `INACTIVO` - Usuario temporalmente deshabilitado
- `SUSPENDIDO` - Usuario suspendido por violaciones
- `BLOQUEADO` - Usuario bloqueado permanentemente

### Estados de Pr√©stamo
- `ACTIVO` - Pr√©stamo en curso
- `DEVUELTO` - Libro devuelto correctamente
- `VENCIDO` - Pr√©stamo vencido sin devolver
- `PERDIDO` - Libro perdido durante el pr√©stamo
- `RENOVADO` - Pr√©stamo renovado
- `CANCELADO` - Pr√©stamo cancelado

## üîß Ejemplos de Uso

### 1. Autenticaci√≥n
```bash
# Login
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "juan.perez@email.com",
    "password": "123456"
  }'

# Registro de usuario
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Pedro",
    "apellido": "Garc√≠a",
    "email": "pedro.garcia@email.com",
    "telefono": "111222333",
    "direccion": "Calle Nueva 123",
    "fechaNacimiento": "1992-03-15"
  }'
```

### 2. Gesti√≥n de Libros
```bash
# Crear un nuevo libro
curl -X POST http://localhost:8080/api/libros \
  -H "Content-Type: application/json" \
  -d '{
    "titulo": "El Principito",
    "autor": "Antoine de Saint-Exup√©ry",
    "descripcion": "Cuento filos√≥fico para ni√±os y adultos",
    "anioPublicacion": 1943,
    "isbn": "9782070612758",
    "numeroPaginas": 96
  }'

# Buscar libros por autor
curl "http://localhost:8080/api/libros/buscar/autor?autor=Cervantes"

# Cambiar estado de un libro
curl -X PATCH http://localhost:8080/api/libros/1/estado \
  -H "Content-Type: application/json" \
  -d "PRESTADO"
```

### 3. Gesti√≥n de Pr√©stamos
```bash
# Crear un pr√©stamo (requiere autenticaci√≥n)
curl -X POST http://localhost:8080/api/prestamos \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer_2" \
  -d '{
    "usuarioId": 2,
    "libroId": 1
  }'

# Devolver un libro
curl -X PATCH http://localhost:8080/api/prestamos/1/devolver \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer_2" \
  -d '{
    "observaciones": "Libro devuelto en buen estado"
  }'

# Renovar un pr√©stamo
curl -X PATCH http://localhost:8080/api/prestamos/1/renovar \
  -H "Authorization: Bearer_2"
```

### 4. Gesti√≥n de Usuarios
```bash
# Obtener todos los usuarios (requiere autenticaci√≥n)
curl -H "Authorization: Bearer_1" http://localhost:8080/api/usuarios

# Promover usuario a bibliotecario
curl -X PATCH http://localhost:8080/api/usuarios/2/promover \
  -H "Authorization: Bearer_1"

# Cambiar estado de usuario
curl -X PATCH http://localhost:8080/api/usuarios/2/estado \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer_1" \
  -d "INACTIVO"
```

## üóÉÔ∏è Base de Datos H2

La aplicaci√≥n utiliza H2 como base de datos embebida en memoria. Esto significa que:

- ‚úÖ **No requiere instalaci√≥n** de base de datos externa
- ‚úÖ **Inicio r√°pido** de la aplicaci√≥n
- ‚úÖ **Datos de ejemplo** cargados autom√°ticamente
- ‚ö†Ô∏è **Los datos se pierden** al reiniciar la aplicaci√≥n

### Acceder a la consola H2
1. Ejecutar la aplicaci√≥n
2. Ir a http://localhost:8080/h2-console
3. Usar las credenciales:
   - JDBC URL: `jdbc:h2:mem:testdb`
   - Usuario: `sa`
   - Contrase√±a: `password`

## üîë Credenciales de Prueba

Al iniciar la aplicaci√≥n, se crean autom√°ticamente los siguientes usuarios:

### Bibliotecario (Acceso completo)
- **Email:** `maria.gonzalez@biblioteca.com`
- **Contrase√±a:** `admin123`
- **Token:** `Bearer_1`

### Usuarios Regulares
- **Email:** `juan.perez@email.com`
- **Contrase√±a:** `123456`
- **Token:** `Bearer_2`

- **Email:** `ana.martinez@email.com`
- **Contrase√±a:** `123456`
- **Token:** `Bearer_3`

## üìä Datos de Ejemplo

La aplicaci√≥n incluye datos de ejemplo:

- **5 libros** de literatura cl√°sica
- **3 usuarios** (1 bibliotecario, 2 usuarios regulares)
- **2 pr√©stamos** (1 activo, 1 vencido)

## üìÅ Estructura del Proyecto

```
src/main/java/com/proyect/api_biblioteca/
‚îú‚îÄ‚îÄ ApiBibliotecaApplication.java          # Clase principal
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ DataInitializer.java              # Inicializaci√≥n de datos
‚îÇ   ‚îú‚îÄ‚îÄ GlobalExceptionHandler.java       # Manejo de excepciones
‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfig.java               # Configuraci√≥n de seguridad
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.java               # Controlador de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ LibroController.java              # Controlador de libros
‚îÇ   ‚îú‚îÄ‚îÄ UsuarioController.java            # Controlador de usuarios
‚îÇ   ‚îî‚îÄ‚îÄ PrestamoController.java           # Controlador de pr√©stamos
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îú‚îÄ‚îÄ LoginRequestDTO.java              # DTO para login
‚îÇ   ‚îú‚îÄ‚îÄ LoginResponseDTO.java             # DTO para respuesta de login
‚îÇ   ‚îú‚îÄ‚îÄ UsuarioDTO.java                   # DTO para usuarios
‚îÇ   ‚îî‚îÄ‚îÄ PrestamoDTO.java                  # DTO para pr√©stamos
‚îú‚îÄ‚îÄ model/entity/
‚îÇ   ‚îú‚îÄ‚îÄ Libro.java                        # Entidad libro
‚îÇ   ‚îú‚îÄ‚îÄ Usuario.java                      # Entidad usuario
‚îÇ   ‚îú‚îÄ‚îÄ Prestamo.java                     # Entidad pr√©stamo
‚îÇ   ‚îú‚îÄ‚îÄ EstadoLibro.java                  # Enum estados de libro
‚îÇ   ‚îú‚îÄ‚îÄ EstadoUsuario.java                # Enum estados de usuario
‚îÇ   ‚îú‚îÄ‚îÄ EstadoPrestamo.java               # Enum estados de pr√©stamo
‚îÇ   ‚îî‚îÄ‚îÄ TipoUsuario.java                  # Enum tipos de usuario
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ LibroRepository.java              # Repositorio de libros
‚îÇ   ‚îú‚îÄ‚îÄ UsuarioRepository.java            # Repositorio de usuarios
‚îÇ   ‚îî‚îÄ‚îÄ PrestamoRepository.java           # Repositorio de pr√©stamos
‚îî‚îÄ‚îÄ service/
    ‚îú‚îÄ‚îÄ LibroService.java                 # Servicio de libros
    ‚îú‚îÄ‚îÄ UsuarioService.java               # Servicio de usuarios
    ‚îú‚îÄ‚îÄ PrestamoService.java              # Servicio de pr√©stamos
    ‚îî‚îÄ‚îÄ AuthService.java                  # Servicio de autenticaci√≥n
```

## üß™ Testing

Para ejecutar las pruebas:
```bash
mvn test
```

## üìñ Documentaci√≥n Adicional

- [Spring Boot Reference](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)
- [Spring Data JPA](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [H2 Database](https://www.h2database.com/html/main.html)

## ü§ù Contribuir

1. Fork el proyecto
2. Crear una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abrir un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.
